# SSHPLUS - Configurações Otimizadas de Kernel
# Baseado no Relatório Técnico de Melhorias - Fase 1
# 
# NOTA: No ambiente Replit, muitas dessas configurações podem não ser aplicáveis
# devido a restrições de segurança. Este arquivo serve como referência para
# implantação em VPS/servidor dedicado.

# ========================================
# TCP CONGESTION CONTROL - BBR
# ========================================
# BBR (Bottleneck Bandwidth and RTT) otimiza throughput em redes com perda
net.core.default_qdisc = fq_codel
net.ipv4.tcp_congestion_control = bbr

# ========================================
# TCP WINDOW SCALING E BUFFERS
# ========================================
# Aumenta capacidade de buffer para conexões de alta velocidade
net.ipv4.tcp_window_scaling = 1
net.core.rmem_max = 134217728          # 128MB
net.core.wmem_max = 134217728          # 128MB
net.ipv4.tcp_rmem = 4096 87380 67108864    # min default max
net.ipv4.tcp_wmem = 4096 65536 67108864    # min default max

# Fila de pacotes e backlog de conexões
net.core.netdev_max_backlog = 250000
net.core.somaxconn = 65535

# ========================================
# TCP FAST OPEN
# ========================================
# Reduz latência em 80-95% para conexões repetidas
net.ipv4.tcp_fastopen = 3

# ========================================
# TCP REUSE E RECYCLE
# ========================================
# Permite reutilização de portas TIME_WAIT
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 15

# ========================================
# ANTI-DDOS E SEGURANÇA
# ========================================
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_synack_retries = 2

# ========================================
# OTIMIZAÇÕES ADICIONAIS
# ========================================
# Keepalive otimizado
net.ipv4.tcp_keepalive_time = 600
net.ipv4.tcp_keepalive_probes = 5
net.ipv4.tcp_keepalive_intvl = 15

# MTU Discovery
net.ipv4.tcp_mtu_probing = 1

# Timestamps
net.ipv4.tcp_timestamps = 1

# SACK (Selective Acknowledgment)
net.ipv4.tcp_sack = 1

# ========================================
# APLICAÇÃO
# ========================================
# Para aplicar em VPS/servidor dedicado, execute:
# sudo sysctl -p /caminho/para/este/arquivo
#
# Para verificar se foi aplicado:
# sysctl net.ipv4.tcp_congestion_control
# sysctl net.core.default_qdisc
